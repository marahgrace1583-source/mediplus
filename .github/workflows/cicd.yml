name: Build and Push to ECR Public

on:
  push:

jobs:
  build-push:
    runs-on: ubuntu-latest

    steps:
      # ✅ Step 1: Checkout your code
      - name: Checkout repository
        uses: action

      # ✅ Step 2: Configure AWS credentials
      - name: Configure AWS credentials
        run:
          aws configure set aws_access_key_id ${{ secrets.AWS_ACCESS_KEY_ID }}
          aws configure set aws_secret_access_key ${{ secrets.AWS_SECRET_ACCESS_KEY }}
          aws configure set default.region ${{ secrets.AWS_REGION }}
      
      # ✅ Step 3: Login to Amazon ECR Public
      - name: login to amazon ECR
        run:
          aws ecr-public get-login-password --region us-east-1 | docker login --username AWS --password-stdin public.ecr.aws/n5r2a7x5


      # ✅ Step 4: Build and push Docker image to ECR Public
      - name: Build and Push Docker image to ECR Public
        run: |
          docker build -t mediplus:v1 .
          docker tag mediplus:v1 public.ecr.aws/n5r2a7x5/mediplus:v1
          docker push public.ecr.aws/n5r2a7x5/mediplus:v1
